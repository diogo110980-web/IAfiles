<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel de Sequência Máxima de Odds abaixo de Limite</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    textarea { width: 100%; height: 200px; font-family: monospace; white-space: pre-wrap; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #f0f0f0; }
    .martingale-section { background: #eef9ff; border: 2px solid #4a90e2; border-radius: 8px; padding: 20px; margin-top: 20px; }
    .martingale-controls { display: grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr)); gap: 20px; margin-bottom: 15px; }
    .control-group label { display:block; font-weight:bold; margin-bottom:5px; }
    .control-group input { width:100%; padding:8px; }
    .odds-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(450px,1fr)); gap:20px; margin-top:20px; }
    .odd-card { background:white; border:2px solid #e74c3c; border-radius:8px; padding:15px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .odd-header { background:#e74c3c; color:white; padding:10px; border-radius:6px 6px 0 0; display:flex; justify-content:space-between; }
    .multiplicador-badge { background:rgba(255,255,255,0.2); padding:4px 8px; border-radius:4px; }
    .valor-investimento { background:#27ae60; color:white; padding:8px; border-radius:4px; margin:10px 0; text-align:center; }
    .ajuste-sequencia { background:#f39c12; color:white; padding:6px; border-radius:4px; margin-bottom:10px; text-align:center; }
    .recalc-btn { background:#27ae60; color:white; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; margin-bottom:15px; }
    .recalc-btn:hover { background:#229954; }
    .alert-min-bet { background:#e74c3c; color:white; padding:6px; border-radius:4px; text-align:center; margin-bottom:10px; }
    .mais-entradas { cursor:pointer; color:#3498db; text-decoration:underline; text-align:center; padding:10px; }
    .linha-oculta { display:none; }
    .martingale-mini-table { width:100%; margin-top:10px; }
    .martingale-mini-table th, .martingale-mini-table td { padding:6px; font-size:13px; }
  </style>
</head>
<body>
  <h1>Painel de Sequência Máxima de Odds abaixo de Limite</h1>
  <label for="oddsInput">Cole os dados (formato: odd data hora):</label>
  <textarea id="oddsInput" placeholder="1.25 14/09/2025 14:30:15
1.89 14/09/2025 14:31:22
..."></textarea>
  <button onclick="calcularPainel()">Calcular</button>
  <div id="resultado"></div>
  <div id="martingaleSection" class="martingale-section" style="display:none;">
    <h2>Calculadora Martingale</h2>
    <div class="martingale-controls">
      <div class="control-group">
        <label for="bancaTotal">Banca Total (R$):</label>
        <input type="number" id="bancaTotal" value="1000" step="0.01">
      </div>
      <div class="control-group">
        <label for="percentualTotal">% da Banca para Investir:</label>
        <input type="number" id="percentualTotal" value="10" step="0.1" min="0.1" max="100">
      </div>
    </div>
    <button class="recalc-btn" onclick="gerarCalculadorasTodasOdds()">Recalcular Martingale</button>
    <div id="oddsGrid" class="odds-grid"></div>
  </div>
  <script>
    const APOSTA_MINIMA = 1.00;
    const limitesGlobais = [1.3, 1.5, 2, 5, 10, 30, 50, 100, 1000];
    let resultadosGlobais = [];

    function calcularMultiplicador(odd) {
      if (odd <= 1.3) return 5.25;   // 5.0 * 1.05
      if (odd <= 1.5) return 3.15;   // 3.0 * 1.05
      if (odd <= 2) return 2.10;     // 2.0 * 1.05
      if (odd <= 5) return 1.31;     // 1.25 * 1.05
      if (odd <= 10) return 1.21;    // 1.15 * 1.05
      if (odd <= 30) return 1.16;    // 1.10 * 1.05
      if (odd <= 50) return 1.13;    // 1.08 * 1.05
      if (odd <= 100) return 1.10;   // 1.05 * 1.05
      return 1.07;                   // 1.02 * 1.05
    }

    function calcularSequenciaOtimizada(ms, inv, m, totalSeq) {
      const rodadaFinal = totalSeq + 1;
      let n = rodadaFinal - (ms - 1) + 1;
      if (n <= 0) return null;
      let orig = n,
          soma = (Math.pow(m, n) - 1) / (m - 1),
          first = inv / soma;
      while (first < APOSTA_MINIMA && n > 1) {
        n--;
        soma = (Math.pow(m, n) - 1) / (m - 1);
        first = inv / soma;
      }
      if (first < APOSTA_MINIMA) return null;
      const rodadaInicial = rodadaFinal - n + 1;
      return {
        numEntradas: n,
        primeiraEntrada: first,
        sequenciaOriginal: orig,
        ajustada: n !== orig,
        sequenciaMaxima: totalSeq,
        rodadaInicial: rodadaInicial
      };
    }

    function calcularPainel() {
      const lines = document.getElementById('oddsInput').value.trim().split('\n').filter(l => l.trim());
      const dados = lines.map((l, i) => {
        const m = l.match(/^\s*([\d,.]+)[^\d]+(\d{2}\/\d{2}\/\d{4})[^\d]+(\d{2}:\d{2}:\d{2})\s*$/);
        if (!m) { alert(`Linha ${i+1} mal formatada`); return null; }
        const odd = parseFloat(m[1].replace(',', '.')); if (isNaN(odd)) { alert(`Linha ${i+1} odd inválida`); return null; }
        const [d, mo, y] = m[2].split('/'), [h, mi, s] = m[3].split(':');
        const ts = new Date(+y, mo-1, +d, +h, +mi, +s); if (isNaN(ts)) { alert(`Linha ${i+1} data inválida`); return null; }
        return { ts, odd };
      }).filter(x => x);
      if (!dados.length) { alert('Nenhum dado válido'); return; }
      dados.sort((a, b) => a.ts - b.ts);
      const now = dados[dados.length-1].ts;
      const intervals = [
        { n:'Total', ms:Infinity }, { n:'Últ 12h', ms:12*3600e3 }, { n:'Últ 6h', ms:6*3600e3 },
        { n:'Últ 3h', ms:3*3600e3 }, { n:'Últ 2h', ms:2*3600e3 }, { n:'Últ 1h', ms:3600e3 }, { n:'Últ 30m', ms:1800e3 }
      ];
      function maxSeq(arr, lim) {
        let H=[]; arr.forEach((v,i)=>v.odd>=lim&&H.push(i)); if (H.length<2) return ''; let M=0;
        for (let j=1; j<H.length; j++){ const iv=H[j]-H[j-1]-1; if(iv>M) M=iv; } return M;
      }
      const R=limitesGlobais.map(()=>[]);
      intervals.forEach((it,j)=>{
        const fl = it.ms===Infinity ? dados : dados.filter(d=>d.ts >= new Date(now-it.ms));
        limitesGlobais.forEach((lim,i)=> R[i][j] = maxSeq(fl, lim));
      });
      R.forEach(r=>{ for(let j=intervals.length-1; j>=0; j--) if(r[j]===''){ let k=j-1; while(k>=0 && r[k]==='') k--; r[j]=k>=0? r[k]: ''; } });
      for(let j=0;j<intervals.length;j++) for(let i=limitesGlobais.length-2;i>=0;i--) if(R[i][j]===''||R[i][j]===undefined) R[i][j]=R[i+1][j];
      resultadosGlobais = R;
      let out = '<table><thead><tr><th>Limite</th>'+intervals.map(it=>`<th>${it.n}</th>`).join('')+'</tr></thead><tbody>';
      limitesGlobais.forEach((l,i)=> out += `<tr><td>${l}</td>`+ intervals.map((_,j)=>`<td>${R[i][j]||'-'}</td>`).join('') +'</tr>');
      out += '</tbody></table>';
      document.getElementById('resultado').innerHTML = out;
      document.getElementById('martingaleSection').style.display = 'block';
      gerarCalculadorasTodasOdds();
    }

    function gerarCalculadorasTodasOdds(){
      const idx=3, ban=+document.getElementById('bancaTotal').value||1000, pct=+document.getElementById('percentualTotal').value||10, inv=(ban*pct)/100;
      let html='';
      limitesGlobais.forEach((lim,i)=>{
        const ms = resultadosGlobais[i][idx]||0, totalSeq = resultadosGlobais[i][0]||0; if(!ms||!totalSeq) return;
        const m = calcularMultiplicador(lim), opt = calcularSequenciaOtimizada(ms, inv, m, totalSeq);
        if(!opt){ html+=`<div class="odd-card"><div class="odd-header"><span>Odd ${lim}</span><span class="multiplicador-badge">×${m.toFixed(2)}</span></div><div class="alert-min-bet">Saldo insuficiente</div></div>`; return; }
        const { numEntradas, primeiraEntrada, ajustada, rodadaInicial } = opt;
        html+=`<div class="odd-card"><div class="odd-header"><span>Odd ${lim}</span><span class="multiplicador-badge">×${m.toFixed(2)}</span></div><div class="valor-investimento">Inv: R$ ${inv.toFixed(2)} (${pct}%)</div>`;
        if(ajustada) html+=`<div class="ajuste-sequencia">Ajustada</div>`;
        html+=`<table class="martingale-mini-table" data-i="${i}"><thead><tr><th>Rodada</th><th>Valor</th><th>Acum.</th><th>Retorno</th><th>Lucro</th></tr></thead><tbody>`;
        let ac=0;
        for(let j=0;j<numEntradas;j++){
          const v=primeiraEntrada*Math.pow(m,j); ac+=v; const r=v*lim, l=r-ac, rod=rodadaInicial+j;
          const cls=j<8?'':'linha-oculta';
          html+=`<tr class="${cls}"><td>${rod}ª</td><td>R$ ${v.toFixed(2)}</td><td>R$ ${ac.toFixed(2)}</td><td>R$ ${r.toFixed(2)}</td><td style="color:${l>0?'#27ae60':'#e74c3c'}">R$ ${l.toFixed(2)}</td></tr>`;
        }
        html+='</tbody></table>';
        if(numEntradas>8) html+=`<div class="mais-entradas" onclick="toggleLinhas(${i})">... e mais ${numEntradas-8} entradas</div>`;
        html+='</div>';
      });
      document.getElementById('oddsGrid').innerHTML = html;
    }

    function toggleLinhas(i){
      const table=document.querySelector(`[data-i="${i}"]`), linhasOcultas=table.querySelectorAll('.linha-oculta'), btn=table.parentElement.querySelector('.mais-entradas');
      if(linhasOcultas[0].style.display==='table-row'){ linhasOcultas.forEach(l=>l.style.display='none'); btn.textContent=`... e mais ${linhasOcultas.length} entradas`; }
      else { linhasOcultas.forEach(l=>l.style.display='table-row'); btn.textContent='Ocultar entradas extras'; }
    }
  </script>
</body>
</html>
